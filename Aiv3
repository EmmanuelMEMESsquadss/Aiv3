-- LocalScript (StarterPlayerScripts)
-- Mobile Speed Customizer with Anti-Protection Bypass

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Only run on mobile
if not UserInputService.TouchEnabled then
	return
end

local player = Players.LocalPlayer
local character, humanoid, hrp

local DEFAULT_SPEED = 16
local currentSpeed = DEFAULT_SPEED
local isSpeedActive = false
local bypassMode = false

-- Speed bypass using velocity manipulation
local bodyVelocity

local function setupCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
	
	-- Store default speed
	if humanoid then
		DEFAULT_SPEED = humanoid.WalkSpeed
	end
	
	-- Clean up old velocity if exists
	if bodyVelocity then
		bodyVelocity:Destroy()
		bodyVelocity = nil
	end
end

if player.Character then setupCharacter(player.Character) end
player.CharacterAdded:Connect(setupCharacter)

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "SpeedCustomizerUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Speed Container
local speedContainer = Instance.new("Frame")
speedContainer.Size = UDim2.new(0, 140, 0, 120)
speedContainer.Position = UDim2.new(0.85, -140, 0.5, -60)
speedContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
speedContainer.BorderSizePixel = 0
speedContainer.Active = true
speedContainer.Parent = gui

local containerCorner = Instance.new("UICorner")
containerCorner.CornerRadius = UDim.new(0, 12)
containerCorner.Parent = speedContainer

-- Title Label
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -20, 0, 25)
titleLabel.Position = UDim2.new(0, 10, 0, 8)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "SPEED"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 16
titleLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = speedContainer

-- Speed Input Box
local speedInput = Instance.new("TextBox")
speedInput.Size = UDim2.new(1, -20, 0, 35)
speedInput.Position = UDim2.new(0, 10, 0, 38)
speedInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
speedInput.BorderSizePixel = 0
speedInput.Font = Enum.Font.GothamBold
speedInput.TextSize = 20
speedInput.TextColor3 = Color3.new(1, 1, 1)
speedInput.PlaceholderText = "16"
speedInput.Text = ""
speedInput.ClearTextOnFocus = false
speedInput.Active = false  -- Don't block input
speedInput.Parent = speedContainer

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 8)
inputCorner.Parent = speedInput

-- Apply Button
local applyBtn = Instance.new("TextButton")
applyBtn.Size = UDim2.new(1, -20, 0, 32)
applyBtn.Position = UDim2.new(0, 10, 0, 80)
applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
applyBtn.BorderSizePixel = 0
applyBtn.Font = Enum.Font.GothamBold
applyBtn.TextSize = 14
applyBtn.TextColor3 = Color3.new(1, 1, 1)
applyBtn.Text = "APPLY"
applyBtn.Active = false  -- Don't block input
applyBtn.Parent = speedContainer

local applyCorner = Instance.new("UICorner")
applyCorner.CornerRadius = UDim.new(0, 8)
applyCorner.Parent = applyBtn

-- Mode Indicator (shows if bypass is active)
local modeIndicator = Instance.new("TextLabel")
modeIndicator.Size = UDim2.new(0, 60, 0, 18)
modeIndicator.Position = UDim2.new(1, -70, 0, 10)
modeIndicator.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
modeIndicator.BorderSizePixel = 0
modeIndicator.Font = Enum.Font.GothamBold
modeIndicator.TextSize = 10
modeIndicator.TextColor3 = Color3.fromRGB(255, 200, 100)
modeIndicator.Text = "DIRECT"
modeIndicator.Parent = speedContainer

local modeCorner = Instance.new("UICorner")
modeCorner.CornerRadius = UDim.new(0, 4)
modeCorner.Parent = modeIndicator

-- Make draggable (only from title area, not buttons)
local dragging, dragInput, dragStart, startPos

local function isDraggableArea(input)
	-- Only allow dragging from title area (top 30 pixels)
	local relativePos = input.Position - speedContainer.AbsolutePosition
	return relativePos.Y < 30
end

speedContainer.InputBegan:Connect(function(input)
	if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and isDraggableArea(input) then
		dragging = true
		dragStart = input.Position
		startPos = speedContainer.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

speedContainer.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		speedContainer.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
end)

-- Speed application functions
local function applyDirectSpeed(speed)
	if humanoid then
		humanoid.WalkSpeed = speed
		return true
	end
	return false
end

local function applyBypassSpeed(speed)
	if not humanoid or not hrp then return false end
	
	bypassMode = true
	modeIndicator.Text = "BYPASS"
	modeIndicator.TextColor3 = Color3.fromRGB(255, 100, 100)
	
	-- Create or update BodyVelocity for movement boost
	if not bodyVelocity or bodyVelocity.Parent ~= hrp then
		bodyVelocity = Instance.new("BodyVelocity")
		bodyVelocity.MaxForce = Vector3.new(0, 0, 0) -- Start disabled
		bodyVelocity.Parent = hrp
	end
	
	return true
end

local function checkIfSpeedLocked()
	if not humanoid then return false end
	
	-- Try to set speed
	local testSpeed = humanoid.WalkSpeed + 1
	humanoid.WalkSpeed = testSpeed
	
	task.wait(0.1)
	
	-- Check if it was reverted
	if math.abs(humanoid.WalkSpeed - testSpeed) > 0.5 then
		-- Speed was locked, restore default
		humanoid.WalkSpeed = DEFAULT_SPEED
		return true
	else
		-- Speed change worked, restore default
		humanoid.WalkSpeed = DEFAULT_SPEED
		return false
	end
end

-- Apply button action
applyBtn.Activated:Connect(function()
	local inputText = speedInput.Text
	local speed = tonumber(inputText)
	
	if not speed then
		-- Invalid input
		applyBtn.Text = "INVALID!"
		applyBtn.BackgroundColor3 = Color3.fromRGB(206, 36, 36)
		task.wait(1)
		applyBtn.Text = "APPLY"
		applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
		return
	end
	
	-- Clamp speed to reasonable values
	speed = math.clamp(speed, 0, 500)
	currentSpeed = speed
	
	-- Try direct method first
	local success = applyDirectSpeed(speed)
	
	-- Check if speed is being locked by the game
	task.wait(0.2)
	local isLocked = checkIfSpeedLocked()
	
	if isLocked then
		-- Direct method failed, switch to bypass
		applyBypassSpeed(speed)
		applyBtn.Text = "BYPASS ON"
		applyBtn.BackgroundColor3 = Color3.fromRGB(255, 140, 60)
	else
		-- Direct method worked
		bypassMode = false
		modeIndicator.Text = "DIRECT"
		modeIndicator.TextColor3 = Color3.fromRGB(100, 255, 100)
		applyBtn.Text = "APPLIED"
		applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
	end
	
	isSpeedActive = true
	
	-- Reset button text
	task.wait(1.5)
	if isSpeedActive then
		applyBtn.Text = "ACTIVE"
	else
		applyBtn.Text = "APPLY"
	end
end)

-- Bypass mode velocity manipulation
RunService.Heartbeat:Connect(function()
	if not bypassMode or not isSpeedActive or not humanoid or not hrp or not bodyVelocity then
		if bodyVelocity and bodyVelocity.MaxForce ~= Vector3.new(0, 0, 0) then
			bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
		end
		return
	end
	
	-- Check if player is moving
	local moveVector = humanoid.MoveVector
	
	if moveVector.Magnitude > 0 then
		-- Player is trying to move
		local speedMultiplier = currentSpeed / DEFAULT_SPEED
		
		-- Calculate velocity boost
		local targetVelocity = moveVector * currentSpeed
		
		-- Apply boost through BodyVelocity
		bodyVelocity.MaxForce = Vector3.new(50000, 0, 50000)
		bodyVelocity.Velocity = Vector3.new(targetVelocity.X, 0, targetVelocity.Z)
	else
		-- Not moving, disable boost
		bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
	end
end)

-- Monitor for speed resets (anti-tamper)
spawn(function()
	while true do
		task.wait(0.5)
		
		if isSpeedActive and not bypassMode and humanoid then
			-- Check if speed was reset by game
			if math.abs(humanoid.WalkSpeed - currentSpeed) > 2 then
				-- Speed was tampered with, reapply
				humanoid.WalkSpeed = currentSpeed
			end
		end
	end
end)

print("Mobile Speed Customizer loaded!")
print("âœ… Direct mode for most games")
print("âœ… Bypass mode for protected games")
print("ðŸ’¡ Type speed value and click APPLY")
