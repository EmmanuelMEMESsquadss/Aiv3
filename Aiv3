-- LocalScript (StarterPlayerScripts)
-- Mobile Speed Customizer with Profile System

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Only run on mobile
if not UserInputService.TouchEnabled then
	return
end

local player = Players.LocalPlayer
local character, humanoid, hrp

local DEFAULT_SPEED = 16
local currentSpeed = DEFAULT_SPEED
local isSpeedActive = false
local currentMethod = "direct"

-- Bypass objects
local bodyVelocity

local function setupCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
	
	if humanoid then
		DEFAULT_SPEED = humanoid.WalkSpeed
	end
	
	-- Clean up old bypass objects
	if bodyVelocity then
		bodyVelocity:Destroy()
		bodyVelocity = nil
	end
end

if player.Character then setupCharacter(player.Character) end
player.CharacterAdded:Connect(setupCharacter)

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "SpeedCustomizerUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Speed Container
local speedContainer = Instance.new("Frame")
speedContainer.Size = UDim2.new(0, 140, 0, 120)
speedContainer.Position = UDim2.new(0.85, -140, 0.5, -60)
speedContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
speedContainer.BorderSizePixel = 0
speedContainer.Active = false
speedContainer.Parent = gui

local containerCorner = Instance.new("UICorner")
containerCorner.CornerRadius = UDim.new(0, 12)
containerCorner.Parent = speedContainer

-- Drag Handle
local dragHandle = Instance.new("Frame")
dragHandle.Size = UDim2.new(1, 0, 0, 33)
dragHandle.Position = UDim2.new(0, 0, 0, 0)
dragHandle.BackgroundTransparency = 1
dragHandle.Active = true
dragHandle.Parent = speedContainer

-- Title Label
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -50, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "SPEED"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 16
titleLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = dragHandle

-- Method Selector Button (+ icon)
local methodBtn = Instance.new("TextButton")
methodBtn.Size = UDim2.new(0, 24, 0, 24)
methodBtn.Position = UDim2.new(1, -28, 0, 4)
methodBtn.Text = "+"
methodBtn.BackgroundColor3 = Color3.fromRGB(46, 147, 216)
methodBtn.TextColor3 = Color3.new(1, 1, 1)
methodBtn.Font = Enum.Font.GothamBold
methodBtn.TextSize = 18
methodBtn.ZIndex = 10
methodBtn.Parent = dragHandle

local methodCorner = Instance.new("UICorner")
methodCorner.CornerRadius = UDim.new(0.5, 0)
methodCorner.Parent = methodBtn

-- Method Menu Container
local methodMenu = Instance.new("Frame")
methodMenu.Size = UDim2.new(0, 150, 0, 0)
methodMenu.Position = UDim2.new(1, 5, 0, 0)
methodMenu.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
methodMenu.BorderSizePixel = 0
methodMenu.ClipsDescendants = true
methodMenu.Visible = false
methodMenu.ZIndex = 5
methodMenu.Parent = speedContainer

local menuCorner = Instance.new("UICorner")
menuCorner.CornerRadius = UDim.new(0, 8)
menuCorner.Parent = methodMenu

-- Method profiles
local methods = {
	{name = "DIRECT", desc = "WalkSpeed", id = "direct", color = Color3.fromRGB(80, 200, 120)},
	{name = "VELOCITY", desc = "Physics", id = "velocity", color = Color3.fromRGB(255, 140, 60)},
	{name = "CFRAME", desc = "Position", id = "cframe", color = Color3.fromRGB(255, 100, 100)},
	{name = "HYBRID", desc = "Mixed", id = "hybrid", color = Color3.fromRGB(150, 100, 255)}
}

local methodButtons = {}

for i, method in ipairs(methods) do
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 32)
	btn.Position = UDim2.new(0, 5, 0, 5 + (i-1) * 37)
	btn.BackgroundColor3 = method.color
	btn.BackgroundTransparency = 0.2
	btn.BorderSizePixel = 0
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 12
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Text = method.name .. " Â· " .. method.desc
	btn.ZIndex = 6
	btn.Parent = methodMenu
	
	local btnCorner = Instance.new("UICorner")
	btnCorner.CornerRadius = UDim.new(0, 6)
	btnCorner.Parent = btn
	
	-- Selection indicator
	local indicator = Instance.new("Frame")
	indicator.Size = UDim2.new(0, 3, 1, -6)
	indicator.Position = UDim2.new(0, 3, 0, 3)
	indicator.BackgroundColor3 = Color3.new(1, 1, 1)
	indicator.BorderSizePixel = 0
	indicator.Visible = (i == 1)
	indicator.ZIndex = 7
	indicator.Parent = btn
	
	local indCorner = Instance.new("UICorner")
	indCorner.CornerRadius = UDim.new(1, 0)
	indCorner.Parent = indicator
	
	methodButtons[i] = {button = btn, indicator = indicator, method = method}
	
	-- Method selection
	btn.Activated:Connect(function()
		currentMethod = method.id
		
		-- Update indicators
		for j, data in ipairs(methodButtons) do
			data.indicator.Visible = (j == i)
			TweenService:Create(data.button, TweenInfo.new(0.2), {
				BackgroundTransparency = (j == i) and 0.2 or 0.5
			}):Play()
		end
		
		-- Visual feedback
		TweenService:Create(btn, TweenInfo.new(0.1), {
			Size = UDim2.new(1, -8, 0, 32)
		}):Play()
		task.wait(0.1)
		TweenService:Create(btn, TweenInfo.new(0.1), {
			Size = UDim2.new(1, -10, 0, 32)
		}):Play()
		
		-- If speed is active, reapply with new method
		if isSpeedActive then
			applySpeed(currentSpeed)
		end
	end)
end

-- Method menu toggle
local menuOpen = false
methodBtn.Activated:Connect(function()
	menuOpen = not menuOpen
	
	if menuOpen then
		methodMenu.Visible = true
		TweenService:Create(methodMenu, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = UDim2.new(0, 150, 0, 155)
		}):Play()
		TweenService:Create(methodBtn, TweenInfo.new(0.2), {
			Rotation = 45,
			BackgroundColor3 = Color3.fromRGB(206, 36, 36)
		}):Play()
	else
		TweenService:Create(methodMenu, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
			Size = UDim2.new(0, 150, 0, 0)
		}):Play()
		TweenService:Create(methodBtn, TweenInfo.new(0.2), {
			Rotation = 0,
			BackgroundColor3 = Color3.fromRGB(46, 147, 216)
		}):Play()
		task.wait(0.2)
		methodMenu.Visible = false
	end
end)

-- Speed Input Box
local speedInput = Instance.new("TextBox")
speedInput.Size = UDim2.new(1, -20, 0, 35)
speedInput.Position = UDim2.new(0, 10, 0, 38)
speedInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
speedInput.BorderSizePixel = 0
speedInput.Font = Enum.Font.GothamBold
speedInput.TextSize = 20
speedInput.TextColor3 = Color3.new(1, 1, 1)
speedInput.PlaceholderText = tostring(DEFAULT_SPEED)
speedInput.Text = ""
speedInput.ClearTextOnFocus = false
speedInput.TextXAlignment = Enum.TextXAlignment.Center
speedInput.Parent = speedContainer

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0, 8)
inputCorner.Parent = speedInput

-- Apply Button
local applyBtn = Instance.new("TextButton")
applyBtn.Size = UDim2.new(1, -20, 0, 32)
applyBtn.Position = UDim2.new(0, 10, 0, 80)
applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
applyBtn.BorderSizePixel = 0
applyBtn.Font = Enum.Font.GothamBold
applyBtn.TextSize = 14
applyBtn.TextColor3 = Color3.new(1, 1, 1)
applyBtn.Text = "APPLY"
applyBtn.Parent = speedContainer

local applyCorner = Instance.new("UICorner")
applyCorner.CornerRadius = UDim.new(0, 8)
applyCorner.Parent = applyBtn

-- Dragging
local dragging = false
local dragStart, startPos

dragHandle.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = speedContainer.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

dragHandle.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		if dragging then
			local delta = input.Position - dragStart
			speedContainer.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end
end)

-- Speed application function
function applySpeed(speed)
	if not humanoid or not hrp then return end
	
	currentSpeed = speed
	
	-- Clean up old bypass
	if bodyVelocity then
		bodyVelocity:Destroy()
		bodyVelocity = nil
	end
	
	if currentMethod == "direct" then
		-- DIRECT: Just set WalkSpeed
		humanoid.WalkSpeed = speed
		
	elseif currentMethod == "velocity" then
		-- VELOCITY: Use BodyVelocity
		bodyVelocity = Instance.new("BodyVelocity")
		bodyVelocity.MaxForce = Vector3.new(100000, 0, 100000)
		bodyVelocity.Velocity = Vector3.zero
		bodyVelocity.Parent = hrp
	end
	
	-- Methods "cframe" and "hybrid" are applied in RunService loop
end

-- Apply button
applyBtn.Activated:Connect(function()
	local speed = tonumber(speedInput.Text)
	
	if not speed then
		applyBtn.Text = "INVALID!"
		applyBtn.BackgroundColor3 = Color3.fromRGB(206, 36, 36)
		task.wait(1)
		applyBtn.Text = "APPLY"
		applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
		return
	end
	
	speed = math.clamp(speed, 0, 500)
	applySpeed(speed)
	isSpeedActive = true
	
	applyBtn.Text = "ACTIVE"
	applyBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
end)

-- Speed boost loop
RunService.Heartbeat:Connect(function(dt)
	if not isSpeedActive or not humanoid or not hrp then return end
	
	-- Get movement direction (works in ALL Roblox versions)
	local moveDir = humanoid.MoveDirection
	
	if moveDir.Magnitude > 0.1 then
		local speedMultiplier = currentSpeed / DEFAULT_SPEED
		
		if currentMethod == "direct" then
			-- Continuously reapply in case game resets it
			if humanoid.WalkSpeed ~= currentSpeed then
				humanoid.WalkSpeed = currentSpeed
			end
			
		elseif currentMethod == "velocity" and bodyVelocity then
			-- Apply velocity in movement direction
			local targetVelocity = moveDir * currentSpeed
			local currentVelocity = hrp.AssemblyLinearVelocity or hrp.Velocity
			bodyVelocity.Velocity = Vector3.new(targetVelocity.X, currentVelocity.Y, targetVelocity.Z)
			
		elseif currentMethod == "cframe" then
			-- CFrame manipulation (direct position change)
			local extraSpeed = currentSpeed - DEFAULT_SPEED
			local moveAmount = moveDir * extraSpeed * dt
			hrp.CFrame = hrp.CFrame + moveAmount
			
		elseif currentMethod == "hybrid" then
			-- Hybrid: Small CFrame + try to set WalkSpeed
			humanoid.WalkSpeed = currentSpeed
			local extraSpeed = (currentSpeed - DEFAULT_SPEED) * 0.3
			local moveAmount = moveDir * extraSpeed * dt
			hrp.CFrame = hrp.CFrame + moveAmount
		end
	else
		-- Not moving
		if bodyVelocity then
			bodyVelocity.Velocity = Vector3.zero
		end
	end
end)

print("Mobile Speed Customizer [PROFILE SYSTEM] loaded!")
print("âœ… 4 Methods: DIRECT/VELOCITY/CFRAME/HYBRID")
print("ðŸ’¡ Click [+] to switch methods")
print("ðŸŽ® Drag from title | Type speed & APPLY")
